{% extends "layout.html" %}

{% block title %}{{ tenant.name }} - ä½¿ç”¨çµ±è¨ˆ{% endblock %}

{% block content %}
<div class="page-header">
    <h1>
        <i data-lucide="bar-chart-2" style="width: 24px; height: 24px; margin-right: 8px;"></i>
        {{ tenant.name }} - ä½¿ç”¨çµ±è¨ˆ
    </h1>
    <a href="{{ url_for('admin.list_tenants') }}" class="btn btn-secondary">
        <i data-lucide="arrow-left" style="width: 16px; height: 16px;"></i>
        è¿”å›åˆ—è¡¨
    </a>
</div>

<!-- Time Period Selector -->
<div class="period-selector">
    <a href="?period=day" class="period-btn {% if current_period == 'day' %}active{% endif %}">
        <i data-lucide="calendar" style="width: 14px; height: 14px;"></i>
        ä»Šæ—¥
    </a>
    <a href="?period=week" class="period-btn {% if current_period == 'week' %}active{% endif %}">
        <i data-lucide="calendar-days" style="width: 14px; height: 14px;"></i>
        æœ¬é€±
    </a>
    <a href="?period=month" class="period-btn {% if current_period == 'month' %}active{% endif %}">
        <i data-lucide="calendar-range" style="width: 14px; height: 14px;"></i>
        æœ¬æœˆ
    </a>
    <a href="?period=year" class="period-btn {% if current_period == 'year' %}active{% endif %}">
        <i data-lucide="calendar-clock" style="width: 14px; height: 14px;"></i>
        æœ¬å¹´
    </a>
</div>

<!-- Summary Cards -->
<div class="stats-grid" style="margin-top: 20px;">
    <div class="stat-card">
        <div class="stat-icon">
            <i data-lucide="scan" style="width: 24px; height: 24px;"></i>
        </div>
        <div class="number">{{ summary.total_processed }}</div>
        <div class="label">ç¸½è™•ç†é‡</div>
        <div class="stat-detail">
            å¹³å‡ {{ summary.avg_daily_processed }} / æ—¥
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon" style="color: var(--success);">
            <i data-lucide="database" style="width: 24px; height: 24px;"></i>
        </div>
        <div class="number" style="color: var(--success);">{{ summary.total_saved }}</div>
        <div class="label">æˆåŠŸå„²å­˜</div>
        <div class="stat-detail">
            æˆåŠŸç‡ {{ summary.success_rate }}%
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon" style="color: var(--danger);">
            <i data-lucide="alert-circle" style="width: 24px; height: 24px;"></i>
        </div>
        <div class="number" style="{% if summary.total_errors > 0 %}color: var(--danger);{% endif %}">{{ summary.total_errors }}</div>
        <div class="label">éŒ¯èª¤æ¬¡æ•¸</div>
        <div class="stat-detail">
            éŒ¯èª¤ç‡ {{ summary.error_rate }}%
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-icon" style="color: var(--accent-purple);">
            <i data-lucide="users" style="width: 24px; height: 24px;"></i>
        </div>
        <div class="number">{{ user_count }}</div>
        <div class="label">æ´»èºç”¨æˆ¶</div>
        <div class="stat-detail">
            {{ summary.active_days }} å¤©æœ‰ä½¿ç”¨
        </div>
    </div>
</div>

<!-- Tabs -->
<div class="tabs-container">
    <div class="tabs">
        <button class="tab-btn active" onclick="switchTab('usage')">
            <i data-lucide="activity" style="width: 16px; height: 16px;"></i>
            ä½¿ç”¨çµ±è¨ˆ
        </button>
        <button class="tab-btn" onclick="switchTab('users')">
            <i data-lucide="users" style="width: 16px; height: 16px;"></i>
            ç”¨æˆ¶çµ±è¨ˆ
        </button>
        <button class="tab-btn" onclick="switchTab('monthly')">
            <i data-lucide="calendar" style="width: 16px; height: 16px;"></i>
            æœˆçµ±è¨ˆ
        </button>
    </div>
</div>

<!-- Usage Tab -->
<div id="tab-usage" class="tab-content active">
    <!-- Chart -->
    <div class="card">
        <h2>
            <i data-lucide="trending-up" style="width: 16px; height: 16px; margin-right: 8px; vertical-align: middle;"></i>
            è™•ç†é‡è¶¨å‹¢
        </h2>
        <div class="chart-container">
            <canvas id="usageChart"></canvas>
        </div>
    </div>

    <!-- Daily Stats Table -->
    <div class="card">
        <h2>
            <i data-lucide="table" style="width: 16px; height: 16px; margin-right: 8px; vertical-align: middle;"></i>
            è©³ç´°è¨˜éŒ„
        </h2>

        {% if stats %}
        <table>
            <thead>
                <tr>
                    <th>æ—¥æœŸ</th>
                    <th style="text-align: center;">è™•ç†åç‰‡</th>
                    <th style="text-align: center;">å„²å­˜åç‰‡</th>
                    <th style="text-align: center;">API å‘¼å«</th>
                    <th style="text-align: center;">éŒ¯èª¤</th>
                    <th style="text-align: center;">æˆåŠŸç‡</th>
                </tr>
            </thead>
            <tbody>
                {% for stat in stats %}
                <tr>
                    <td style="color: var(--text-secondary);">{{ stat.date }}</td>
                    <td style="text-align: center;">
                        <span class="{% if stat.cards_processed > 0 %}text-accent{% else %}text-muted{% endif %}">
                            {{ stat.cards_processed }}
                        </span>
                    </td>
                    <td style="text-align: center;">
                        <span class="{% if stat.cards_saved > 0 %}text-success{% else %}text-muted{% endif %}">
                            {{ stat.cards_saved }}
                        </span>
                    </td>
                    <td style="text-align: center; color: var(--text-secondary);">{{ stat.api_calls }}</td>
                    <td style="text-align: center;">
                        <span class="{% if stat.errors > 0 %}text-danger{% else %}text-muted{% endif %}">
                            {{ stat.errors }}
                        </span>
                    </td>
                    <td style="text-align: center;">
                        {% if stat.cards_processed > 0 %}
                        <span class="badge {% if (stat.cards_saved / stat.cards_processed * 100) >= 90 %}badge-success{% elif (stat.cards_saved / stat.cards_processed * 100) >= 70 %}badge-warning{% else %}badge-danger{% endif %}">
                            {{ ((stat.cards_saved / stat.cards_processed) * 100) | round(1) }}%
                        </span>
                        {% else %}
                        <span class="text-muted">-</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <div class="empty-state">
            <div class="empty-state-icon">
                <i data-lucide="bar-chart" style="width: 48px; height: 48px;"></i>
            </div>
            <h3>å°šç„¡ä½¿ç”¨è¨˜éŒ„</h3>
            <p>é–‹å§‹ä½¿ç”¨å¾Œé€™è£¡æœƒé¡¯ç¤ºçµ±è¨ˆè³‡æ–™</p>
        </div>
        {% endif %}
    </div>
</div>

<!-- Users Tab -->
<div id="tab-users" class="tab-content">
    <div class="card">
        <h2 style="display: flex; justify-content: space-between; align-items: center;">
            <span>
                <i data-lucide="users" style="width: 16px; height: 16px; margin-right: 8px; vertical-align: middle;"></i>
                ç”¨æˆ¶ä½¿ç”¨çµ±è¨ˆ
                <span class="badge badge-info" style="margin-left: 8px;">{{ user_count }} ä½ç”¨æˆ¶</span>
            </span>
            <button onclick="syncUserProfiles('{{ tenant.id }}')" 
                    class="btn btn-sm" 
                    style="background: var(--accent-purple); color: white; border: none; padding: 6px 12px; border-radius: 6px; cursor: pointer; font-size: 0.875rem;"
                    id="sync-profiles-btn">
                <i data-lucide="refresh-cw" style="width: 14px; height: 14px; margin-right: 4px; vertical-align: middle;"></i>
                åŒæ­¥ç”¨æˆ¶è³‡è¨Š
            </button>
        </h2>

        {% if top_users %}
        <table>
            <thead>
                <tr>
                    <th style="width: 50px;">æ’å</th>
                    <th>ç”¨æˆ¶</th>
                    <th style="text-align: center;">è™•ç†æ•¸</th>
                    <th style="text-align: center;">å„²å­˜æ•¸</th>
                    <th style="text-align: center;">éŒ¯èª¤æ•¸</th>
                    <th style="text-align: center;">æˆåŠŸç‡</th>
                </tr>
            </thead>
            <tbody>
                {% for user in top_users %}
                <tr>
                    <td style="text-align: center;">
                        {% if loop.index == 1 %}
                        <span style="color: #FFD700;">ğŸ¥‡</span>
                        {% elif loop.index == 2 %}
                        <span style="color: #C0C0C0;">ğŸ¥ˆ</span>
                        {% elif loop.index == 3 %}
                        <span style="color: #CD7F32;">ğŸ¥‰</span>
                        {% else %}
                        <span class="text-muted">{{ loop.index }}</span>
                        {% endif %}
                    </td>
                    <td>
                        <div style="display: flex; align-items: center; gap: 12px;">
                            {% if user.picture_url %}
                            <img src="{{ user.picture_url }}" alt="Avatar" 
                                 style="width: 36px; height: 36px; border-radius: 50%; object-fit: cover; border: 2px solid var(--border-color);"
                                 onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                            <div style="display: none; width: 36px; height: 36px; border-radius: 50%; background: var(--surface-light); align-items: center; justify-content: center;">
                                <i data-lucide="user" style="width: 18px; height: 18px; color: var(--text-muted);"></i>
                            </div>
                            {% else %}
                            <div style="width: 36px; height: 36px; border-radius: 50%; background: var(--surface-light); display: flex; align-items: center; justify-content: center;">
                                <i data-lucide="user" style="width: 18px; height: 18px; color: var(--text-muted);"></i>
                            </div>
                            {% endif %}
                            <div>
                                {% if user.display_name %}
                                <div style="font-weight: 500; color: var(--text-primary);">{{ user.display_name }}</div>
                                <div style="font-size: 0.75rem; color: var(--text-muted);">{{ user.line_user_id[:12] }}...</div>
                                {% else %}
                                <code style="font-size: 0.85rem; color: var(--accent-purple);">{{ user.line_user_id[:12] }}...</code>
                                {% endif %}
                            </div>
                        </div>
                    </td>
                    <td style="text-align: center;">
                        <span class="text-accent">{{ user.total_processed }}</span>
                    </td>
                    <td style="text-align: center;">
                        <span class="text-success">{{ user.total_saved }}</span>
                    </td>
                    <td style="text-align: center;">
                        <span class="{% if user.total_errors > 0 %}text-danger{% else %}text-muted{% endif %}">
                            {{ user.total_errors }}
                        </span>
                    </td>
                    <td style="text-align: center;">
                        {% if user.success_rate %}
                        <span class="badge {% if user.success_rate >= 90 %}badge-success{% elif user.success_rate >= 70 %}badge-warning{% else %}badge-danger{% endif %}">
                            {{ user.success_rate }}%
                        </span>
                        {% else %}
                        <span class="text-muted">-</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <div class="empty-state">
            <div class="empty-state-icon">
                <i data-lucide="user-x" style="width: 48px; height: 48px;"></i>
            </div>
            <h3>å°šç„¡ç”¨æˆ¶è³‡æ–™</h3>
            <p>é–‹å§‹ä½¿ç”¨å¾Œé€™è£¡æœƒé¡¯ç¤ºç”¨æˆ¶çµ±è¨ˆ</p>
        </div>
        {% endif %}
    </div>
</div>

<!-- Monthly Tab -->
<div id="tab-monthly" class="tab-content">
    <div class="card">
        <h2>
            <i data-lucide="calendar" style="width: 16px; height: 16px; margin-right: 8px; vertical-align: middle;"></i>
            æœˆåº¦çµ±è¨ˆ
        </h2>

        {% if monthly_stats %}
        <table>
            <thead>
                <tr>
                    <th>æœˆä»½</th>
                    <th style="text-align: center;">è™•ç†åç‰‡</th>
                    <th style="text-align: center;">å„²å­˜åç‰‡</th>
                    <th style="text-align: center;">éŒ¯èª¤</th>
                    <th style="text-align: center;">æ´»èºå¤©æ•¸</th>
                    <th style="text-align: center;">æˆåŠŸç‡</th>
                </tr>
            </thead>
            <tbody>
                {% for stat in monthly_stats %}
                <tr>
                    <td style="color: var(--text-primary); font-weight: 500;">{{ stat.month }}</td>
                    <td style="text-align: center;">
                        <span class="text-accent">{{ stat.cards_processed }}</span>
                    </td>
                    <td style="text-align: center;">
                        <span class="text-success">{{ stat.cards_saved }}</span>
                    </td>
                    <td style="text-align: center;">
                        <span class="{% if stat.errors > 0 %}text-danger{% else %}text-muted{% endif %}">
                            {{ stat.errors }}
                        </span>
                    </td>
                    <td style="text-align: center; color: var(--text-secondary);">
                        {{ stat.active_days }} å¤©
                    </td>
                    <td style="text-align: center;">
                        {% if stat.cards_processed > 0 %}
                        <span class="badge {% if (stat.cards_saved / stat.cards_processed * 100) >= 90 %}badge-success{% elif (stat.cards_saved / stat.cards_processed * 100) >= 70 %}badge-warning{% else %}badge-danger{% endif %}">
                            {{ ((stat.cards_saved / stat.cards_processed) * 100) | round(1) }}%
                        </span>
                        {% else %}
                        <span class="text-muted">-</span>
                        {% endif %}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <div class="empty-state">
            <div class="empty-state-icon">
                <i data-lucide="calendar-x" style="width: 48px; height: 48px;"></i>
            </div>
            <h3>å°šç„¡æœˆåº¦è³‡æ–™</h3>
            <p>ç´¯ç©è¶³å¤ è³‡æ–™å¾Œæœƒé¡¯ç¤ºæœˆåº¦çµ±è¨ˆ</p>
        </div>
        {% endif %}
    </div>
</div>

<!-- Actions -->
<div class="card">
    <h2>
        <i data-lucide="settings" style="width: 16px; height: 16px; margin-right: 8px; vertical-align: middle;"></i>
        æ“ä½œ
    </h2>
    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
        <a href="{{ url_for('admin.edit_tenant', tenant_id=tenant.id) }}" class="btn btn-primary">
            <i data-lucide="edit-2" style="width: 16px; height: 16px;"></i>
            ç·¨è¼¯ç§Ÿæˆ¶è¨­å®š
        </a>
        <button onclick="testConnection('{{ tenant.id }}')" class="btn btn-success">
            <i data-lucide="wifi" style="width: 16px; height: 16px;"></i>
            æ¸¬è©¦é€£ç·š
        </button>
    </div>
</div>

<!-- Test Modal -->
<div id="testModal" style="display: none; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); backdrop-filter: blur(4px); z-index: 1000;">
    <div style="background: var(--bg-secondary); border: 1px solid var(--border-color); max-width: 500px; margin: 100px auto; padding: 28px; border-radius: 14px; box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);">
        <h3 style="margin-bottom: 20px; color: var(--text-primary); font-weight: 600; display: flex; align-items: center; gap: 10px;">
            <i data-lucide="wifi" style="width: 20px; height: 20px;"></i>
            é€£ç·šæ¸¬è©¦çµæœ
        </h3>
        <div id="testResults" style="color: var(--text-secondary);"></div>
        <button onclick="closeTestModal()" class="btn btn-secondary" style="margin-top: 20px;">
            <i data-lucide="x" style="width: 16px; height: 16px;"></i>
            é—œé–‰
        </button>
    </div>
</div>

<style>
/* Period Selector */
.period-selector {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}

.period-btn {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 8px 16px;
    background: var(--bg-secondary);
    border: 1px solid var(--border-color);
    border-radius: 8px;
    color: var(--text-secondary);
    text-decoration: none;
    font-size: 0.9rem;
    transition: all 0.2s ease;
}

.period-btn:hover {
    background: var(--bg-card);
    border-color: var(--accent-purple);
    color: var(--text-primary);
}

.period-btn.active {
    background: linear-gradient(135deg, var(--accent-purple), var(--accent-blue));
    border-color: transparent;
    color: white;
}

/* Stat Detail */
.stat-detail {
    font-size: 0.8rem;
    color: var(--text-muted);
    margin-top: 4px;
}

/* Tabs */
.tabs-container {
    margin-top: 24px;
}

.tabs {
    display: flex;
    gap: 4px;
    border-bottom: 1px solid var(--border-color);
    padding-bottom: 0;
}

.tab-btn {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 12px 20px;
    background: transparent;
    border: none;
    border-bottom: 2px solid transparent;
    color: var(--text-secondary);
    cursor: pointer;
    font-size: 0.95rem;
    transition: all 0.2s ease;
    margin-bottom: -1px;
}

.tab-btn:hover {
    color: var(--text-primary);
    background: var(--bg-secondary);
}

.tab-btn.active {
    color: var(--accent-purple);
    border-bottom-color: var(--accent-purple);
}

.tab-content {
    display: none;
    margin-top: 20px;
}

.tab-content.active {
    display: block;
}

/* Chart Container */
.chart-container {
    position: relative;
    height: 300px;
    margin-top: 16px;
}

/* Badge variations */
.badge-warning {
    background: rgba(255, 193, 7, 0.15);
    color: #ffc107;
}

.badge-info {
    background: rgba(59, 130, 246, 0.15);
    color: #3b82f6;
}
</style>
{% endblock %}

{% block scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Tab switching
function switchTab(tabName) {
    // Hide all tab contents
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
    });

    // Remove active from all buttons
    document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('active');
    });

    // Show selected tab
    document.getElementById('tab-' + tabName).classList.add('active');
    event.target.closest('.tab-btn').classList.add('active');

    lucide.createIcons();
}

// Chart.js setup
const ctx = document.getElementById('usageChart');
if (ctx) {
    // Prepare data from stats (reverse to show oldest first)
    const statsData = {{ stats | tojson | safe }};
    const labels = statsData.map(s => s.date).reverse();
    const processedData = statsData.map(s => s.cards_processed).reverse();
    const savedData = statsData.map(s => s.cards_saved).reverse();
    const errorsData = statsData.map(s => s.errors).reverse();

    new Chart(ctx, {
        type: 'line',
        data: {
            labels: labels,
            datasets: [
                {
                    label: 'è™•ç†æ•¸',
                    data: processedData,
                    borderColor: '#8b5cf6',
                    backgroundColor: 'rgba(139, 92, 246, 0.1)',
                    fill: true,
                    tension: 0.4
                },
                {
                    label: 'å„²å­˜æ•¸',
                    data: savedData,
                    borderColor: '#22c55e',
                    backgroundColor: 'rgba(34, 197, 94, 0.1)',
                    fill: true,
                    tension: 0.4
                },
                {
                    label: 'éŒ¯èª¤æ•¸',
                    data: errorsData,
                    borderColor: '#ef4444',
                    backgroundColor: 'rgba(239, 68, 68, 0.1)',
                    fill: true,
                    tension: 0.4
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            interaction: {
                intersect: false,
                mode: 'index'
            },
            plugins: {
                legend: {
                    position: 'top',
                    labels: {
                        color: '#a1a1aa',
                        usePointStyle: true,
                        padding: 20
                    }
                }
            },
            scales: {
                x: {
                    grid: {
                        color: 'rgba(161, 161, 170, 0.1)'
                    },
                    ticks: {
                        color: '#71717a',
                        maxTicksLimit: 10
                    }
                },
                y: {
                    beginAtZero: true,
                    grid: {
                        color: 'rgba(161, 161, 170, 0.1)'
                    },
                    ticks: {
                        color: '#71717a'
                    }
                }
            }
        }
    });
}

// Test connection
function testConnection(tenantId) {
    document.getElementById('testModal').style.display = 'block';
    document.getElementById('testResults').innerHTML = '<p>æ¸¬è©¦ä¸­...</p>';
    lucide.createIcons();

    fetch('/admin/api/tenants/' + tenantId + '/test', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'}
    })
    .then(response => response.json())
    .then(data => {
        let html = '<div style="display: flex; flex-direction: column; gap: 12px;">';
        for (const [service, result] of Object.entries(data)) {
            const isSuccess = result.status === 'success';
            const isSkipped = result.status === 'skipped';
            const iconName = isSuccess ? 'check-circle' : (isSkipped ? 'minus-circle' : 'x-circle');
            const color = isSuccess ? 'var(--success)' : (isSkipped ? 'var(--text-muted)' : 'var(--danger)');
            const msg = result.message || result.bot_name || result.database_title || '';
            html += `
                <div style="display: flex; align-items: center; gap: 10px; padding: 12px; background: var(--bg-card); border-radius: 8px; border: 1px solid var(--border-color);">
                    <i data-lucide="${iconName}" style="width: 20px; height: 20px; color: ${color};"></i>
                    <div>
                        <strong style="color: var(--text-primary);">${service.toUpperCase()}</strong>
                        <span style="color: ${color}; margin-left: 8px;">${result.status}</span>
                        ${msg ? `<br><small style="color: var(--text-muted);">${msg}</small>` : ''}
                    </div>
                </div>
            `;
        }
        html += '</div>';
        document.getElementById('testResults').innerHTML = html;
        lucide.createIcons();
    })
    .catch(error => {
        document.getElementById('testResults').innerHTML = `
            <div style="display: flex; align-items: center; gap: 10px; color: var(--danger);">
                <i data-lucide="alert-triangle" style="width: 20px; height: 20px;"></i>
                æ¸¬è©¦å¤±æ•—: ${error}
            </div>
        `;
        lucide.createIcons();
    });
}

function closeTestModal() {
    document.getElementById('testModal').style.display = 'none';
}

function syncUserProfiles(tenantId) {
    const btn = document.getElementById('sync-profiles-btn');
    const originalText = btn.innerHTML;
    
    // ç¦ç”¨æŒ‰éˆ•ä¸¦é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
    btn.disabled = true;
    btn.innerHTML = '<i data-lucide="loader-2" style="width: 14px; height: 14px; margin-right: 4px; vertical-align: middle; animation: spin 1s linear infinite;"></i>åŒæ­¥ä¸­...';
    lucide.createIcons();
    
    fetch(`/admin/api/tenants/${tenantId}/users/sync-profiles`, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        }
    })
    .then(response => response.json())
    .then(data => {
        btn.disabled = false;
        btn.innerHTML = originalText;
        lucide.createIcons();
        
        if (data.error) {
            alert('åŒæ­¥å¤±æ•—: ' + data.error);
        } else {
            alert(`åŒæ­¥å®Œæˆï¼\nå·²åŒæ­¥: ${data.synced} å€‹ç”¨æˆ¶\nå¤±æ•—: ${data.failed} å€‹ç”¨æˆ¶\n\nè«‹é‡æ–°æ•´ç†é é¢æŸ¥çœ‹æ›´æ–°å¾Œçš„ç”¨æˆ¶è³‡è¨Šã€‚`);
            // å¯é¸ï¼šè‡ªå‹•é‡æ–°è¼‰å…¥é é¢
            setTimeout(() => {
                window.location.reload();
            }, 1000);
        }
    })
    .catch(error => {
        btn.disabled = false;
        btn.innerHTML = originalText;
        lucide.createIcons();
        alert('åŒæ­¥å¤±æ•—: ' + error.message);
    });
}

// Initialize icons
lucide.createIcons();
</script>
<style>
@keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}
</style>
{% endblock %}
