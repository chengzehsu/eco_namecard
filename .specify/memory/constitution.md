# 專案憲章

## 專案概述
LINE Bot 名片管理系統，使用 Google Gemini AI 辨識名片內容，並自動儲存至 Notion 資料庫。

## 核心原則

### 1. 安全優先
- 對所有使用者輸入實施全面的驗證
- 使用 LINE 簽章驗證確保 webhook 安全
- 實施速率限制（每位使用者每日 50 張名片）以防止濫用
- 使用 Fernet 對稱加密保護敏感資料
- 遵循 OWASP 安全最佳實踐

### 2. 使用者體驗
- 提供清晰、可操作的繁體中文錯誤訊息
- 支援批次處理並即時更新進度
- 實作 Quick Reply 按鈕提供直覺式互動
- 維護多卡片操作的會話狀態
- 確保 2 秒內回應

### 3. AI 整合
- 使用 Google Gemini AI 並配置備援 API 金鑰
- 實作單張圖片中的多名片偵測
- 優先擷取中文內容以符合台灣市場需求
- 提供信心分數進行品質評估
- 優雅處理 API 失敗並通知使用者

### 4. 資料管理
- 在 Notion 中儲存結構化資料並進行適當驗證
- 正規化台灣地址和電話號碼
- 實作基於使用者的資料隔離
- 支援按姓名和公司搜尋
- 維護資料一致性和完整性

### 5. 程式碼品質
- 維持 70% 以上的測試覆蓋率（核心邏輯 90% 以上）
- 遵循 PEP 8 風格指南並使用 Black 格式化
- 在整個程式碼庫中使用型別提示
- 記錄所有公開 API 和複雜邏輯
- 實作適當的錯誤處理和日誌記錄

### 6. 部署與維運
- 使用 GitHub Actions 自動化 CI/CD 流程
- 實作健康檢查端點進行監控
- 所有設定使用環境變數
- 在 Zeabur 上支援零停機部署
- 啟用 Sentry 進行錯誤追蹤和告警

### 7. 架構標準
- 遵循 Clean Architecture 原則並清楚分層
- 使用 Pydantic 模型進行資料驗證
- 在 `simple_config.py` 中集中設定
- 對外部服務實作 Repository 模式
- 保持業務邏輯與框架無關

## 開發流程
1. 先撰寫規格說明（要什麼和為什麼）
2. 建立包含架構決策的技術計畫
3. 分解為小型、可測試的任務
4. 實作並撰寫全面的測試
5. 檢查安全性和效能
6. 使用自動化健康檢查進行部署

## 技術限制
- **程式語言**: Python 3.9+
- **框架**: Flask 作為網頁伺服器
- **AI 服務**: Google Gemini AI（主要 + 備援）
- **資料庫**: Notion API
- **訊息服務**: LINE Messaging API
- **部署平台**: Zeabur 搭配 Docker 容器

## 品質關卡
- 部署前所有測試必須通過
- 安全掃描（Bandit、Safety）不得有重大問題
- 程式碼覆蓋率不得下降
- 部署後健康檢查必須成功
- PR 審查必須獲得批准（包含 Qodo AI 審查）

## 不可妥協事項
- 絕不提交機密資訊或 API 金鑰至版本庫
- 始終驗證和淨化使用者輸入
- 提供雙語支援（中文為主，英文為輔）
- 維護 API 變更的向後相容性
- 在提交訊息中記錄所有破壞性變更
